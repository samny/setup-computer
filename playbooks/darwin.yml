---
- name: macOS Setup
  block:
    - name: Load macOS variables
      ansible.builtin.include_vars: ../vars/macos.yml
      tags: always

    - name: Load common variables
      ansible.builtin.include_vars: ../vars/common.yml
      tags: always

    - name: Run Xcode Command Line Tools role
      ansible.builtin.include_role:
        name: xcode-clt
      tags: [bootstrap, xcode]

    - name: Run Homebrew setup role
      ansible.builtin.include_role:
        name: homebrew-setup
      tags: [bootstrap, homebrew, packages, apps]

    - name: Run dotfiles role
      ansible.builtin.include_role:
        name: dotfiles
      tags: [dotfiles, config]

    - name: Run shell setup role
      ansible.builtin.include_role:
        name: shell-setup
      tags: [shell, config]

    - name: Run Podman macOS setup role
      ansible.builtin.include_role:
        name: podman-macos
      tags: [macos, podman]
      when: "'podman' in homebrew_packages"

    - name: Run macOS defaults role
      ansible.builtin.include_role:
        name: macos-defaults
      tags: [macos, config]
