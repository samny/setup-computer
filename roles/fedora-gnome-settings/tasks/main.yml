---
# Core GNOME settings that are applied by default
# For optional/experimental settings, see optional.yml

- name: Create backup directory for GNOME settings
  ansible.builtin.file:
    path: "{{ ansible_facts['env']['HOME'] }}/.config/gnome-settings-backups"
    state: directory
    mode: "0755"

- name: Get current timestamp for backup
  ansible.builtin.set_fact:
    backup_timestamp: "{{ ansible_facts['date_time']['iso8601_basic_short'] }}"

- name: Backup current GNOME settings
  ansible.builtin.shell: |
    dconf dump / > "{{ ansible_facts['env']['HOME'] }}/.config/gnome-settings-backups/gnome-settings-{{ backup_timestamp }}.dconf"
  changed_when: true

- name: Display backup location
  ansible.builtin.debug:
    msg: "GNOME settings backed up to: {{ ansible_facts['env']['HOME'] }}/.config/gnome-settings-backups/gnome-settings-{{ backup_timestamp }}.dconf"

- name: Swap Command and Control keys for Apple keyboard behavior
  ansible.builtin.shell: |
    gsettings set org.gnome.desktop.input-sources xkb-options "['ctrl:swap_lwin_lctl', 'ctrl:swap_rwin_rctl']"
  changed_when: true
