---
- name: Set Finder to always show list view
  community.general.osx_defaults:
    domain: com.apple.finder
    key: FXPreferredViewStyle
    type: string
    value: "Nlsv"
    state: present

# - name: Show hidden files in Finder
#   community.general.osx_defaults:
#     domain: com.apple.finder
#     key: AppleShowAllFiles
#     type: bool
#     value: true
#     state: present

# - name: Show path bar in Finder
#   community.general.osx_defaults:
#     domain: com.apple.finder
#     key: ShowPathbar
#     type: bool
#     value: true
#     state: present

- name: Show all filename extensions
  community.general.osx_defaults:
    domain: NSGlobalDomain
    key: AppleShowAllExtensions
    type: bool
    value: true
    state: present

- name: Enable Dock auto-hide
  community.general.osx_defaults:
    domain: com.apple.dock
    key: autohide
    type: bool
    value: true
    state: present

- name: Set Dock icon size
  community.general.osx_defaults:
    domain: com.apple.dock
    key: tilesize
    type: int
    value: 48
    state: present

# - name: Set key repeat rate (fastest)
#   community.general.osx_defaults:
#     domain: NSGlobalDomain
#     key: KeyRepeat
#     type: int
#     value: 2
#     state: present

# - name: Set initial key repeat delay
#   community.general.osx_defaults:
#     domain: NSGlobalDomain
#     key: InitialKeyRepeat
#     type: int
#     value: 15
#     state: present

# - name: Enable tap to click
#   community.general.osx_defaults:
#     domain: com.apple.AppleMultitouchTrackpad
#     key: Clicking
#     type: bool
#     value: true
#     state: present

# - name: Set tracking speed
#   community.general.osx_defaults:
#     domain: NSGlobalDomain
#     key: com.apple.trackpad.scaling
#     type: float
#     value: 1.5
#     state: present

- name: Set default save location to Downloads
  community.general.osx_defaults:
    domain: com.apple.screencapture
    key: location
    type: string
    value: "{{ ansible_facts['env']['HOME'] }}/Downloads"
    state: present

- name: Set Terminal font to FiraCode Nerd Font
  community.general.osx_defaults:
    domain: com.apple.Terminal
    key: "Default Window Settings"
    type: string
    value: "Pro"
    state: present

- name: Set Terminal font family
  ansible.builtin.shell: |
    /usr/libexec/PlistBuddy -c "Delete :'Window Settings':'Pro':'Font'" ~/Library/Preferences/com.apple.Terminal.plist 2>/dev/null || true
    /usr/libexec/PlistBuddy -c "Add :'Window Settings':'Pro':'Font' data $(echo 'YnBsaXN0MDDUAQIDBAUGBwpYJHZlcnNpb25ZJGFyY2hpdmVyVCR0b3BYJG9iamVjdHMSAAGGoF8QD05TS2V5ZWRBcmNoaXZlctEICVRyb290gAGvEBELDBYXGBkaGx0fIiQmKCosLlUkbnVsbNUNDg8QERITFBVWJGNSYXNZXXAWTLNGB250TmFtZUF0dHJpYnV0ZVYkY2xhc3NfEBFOU0ZvbnRTaXplQXR0cmlidXRlVk5TU2l6ZVhOU0ZvbnROYW1lgAKAA4AGgBAjQCwAAAAAAABfEBdGaXJhQ29kZU5lcmRGb250LVJlZ3VsYXLSHR4gIVokY2xhc3NuYW1lWCRjbGFzc2VzXxAQTlNNdXRhYmxlRGljdGlvbmFyeaMgISNcTlNEaWN0aW9uYXJ5WE5TT2JqZWN00h0eJSdfEA9OU011dGFibGVTdHJpbmemJScoI1hOU1N0cmluZ9IHKSorXxAPTlNLZXllZEFyY2hpdmVygAF5JSYrLTAxNDY4Oj1AQ0ZJS0xOTlBSU1RVVlhZW1xdX2BhYmRlaGprbW5wcnN1dnd5ent8fn+BgoSFhoeIiYuMjY+QkZOUlZaYmZqbnJ6fo6SlAAAAAAAAAEIBAAAAAAAALwAAAAAAAAAAAAAAAAAAAKc=' | base64 -D)" ~/Library/Preferences/com.apple.Terminal.plist
  changed_when: true
  failed_when: false

- name: Create iTerm2 dynamic profile for FiraCode Nerd Font
  ansible.builtin.copy:
    content: |
      {
        "Profiles": [
          {
            "Name": "Default",
            "Guid": "Default",
            "Normal Font": "FiraCodeNerdFont-Regular 13",
            "Non Ascii Font": "FiraCodeNerdFont-Regular 13"
          }
        ]
      }
    dest: "{{ ansible_facts['env']['HOME'] }}/Library/Application Support/iTerm2/DynamicProfiles/font.json"
    mode: "0644"
  failed_when: false

- name: Restart Finder to apply changes
  ansible.builtin.command: killall Finder
  changed_when: true
  failed_when: false

- name: Restart Dock to apply changes
  ansible.builtin.command: killall Dock
  changed_when: true
  failed_when: false
